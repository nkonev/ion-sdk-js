var IonSDK=function(g){var I={};function C(A){if(I[A])return I[A].exports;var n=I[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,C),n.l=!0,n.exports}return C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:A})},C.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},C.t=function(g,I){if(1&I&&(g=C(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var n in g)C.d(A,n,function(I){return g[I]}.bind(null,n));return A},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=1)}([function(module,exports,__webpack_require__){"use strict";eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.makeRemote = exports.LocalStream = exports.VideoConstraints = void 0;\nconst resolutions = ['qvga', 'vga', 'shd', 'hd', 'fhd', 'qhd'];\nexports.VideoConstraints = {\n    qvga: {\n        resolution: {\n            width: { ideal: 320 },\n            height: { ideal: 180 },\n            frameRate: {\n                ideal: 15,\n                max: 30,\n            },\n        },\n        encodings: {\n            maxBitrate: 150000,\n            maxFramerate: 15.0,\n        },\n    },\n    vga: {\n        resolution: {\n            width: { ideal: 640 },\n            height: { ideal: 360 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 500000,\n            maxFramerate: 30.0,\n        },\n    },\n    shd: {\n        resolution: {\n            width: { ideal: 960 },\n            height: { ideal: 540 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 1200000,\n            maxFramerate: 30.0,\n        },\n    },\n    hd: {\n        resolution: {\n            width: { ideal: 1280 },\n            height: { ideal: 720 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 2500000,\n            maxFramerate: 30.0,\n        },\n    },\n    fhd: {\n        resolution: {\n            width: { ideal: 1920 },\n            height: { ideal: 1080 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 4000000,\n            maxFramerate: 30.0,\n        },\n    },\n    qhd: {\n        resolution: {\n            width: { ideal: 2560 },\n            height: { ideal: 1440 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 8000000,\n            maxFramerate: 30.0,\n        },\n    },\n};\nconst defaults = {\n    resolution: 'hd',\n    codec: 'vp8',\n    audio: true,\n    video: true,\n    simulcast: false,\n};\nclass LocalStream extends MediaStream {\n    constructor(stream, constraints) {\n        super(stream);\n        this.constraints = constraints;\n    }\n    static getUserMedia(constraints = defaults) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const stream = yield navigator.mediaDevices.getUserMedia({\n                audio: LocalStream.computeAudioConstraints(Object.assign(Object.assign({}, defaults), constraints)),\n                video: LocalStream.computeVideoConstraints(Object.assign(Object.assign({}, defaults), constraints)),\n            });\n            return new LocalStream(stream, Object.assign(Object.assign({}, defaults), constraints));\n        });\n    }\n    static getDisplayMedia(constraints = {\n        codec: 'vp8',\n        resolution: 'hd',\n        audio: false,\n        video: true,\n        simulcast: false,\n    }) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // @ts-ignore\n            const stream = yield navigator.mediaDevices.getDisplayMedia(constraints);\n            return new LocalStream(stream, Object.assign(Object.assign({}, defaults), constraints));\n        });\n    }\n    static computeAudioConstraints(constraints) {\n        return constraints.audio;\n    }\n    static computeVideoConstraints(constraints) {\n        if (constraints.video instanceof Object) {\n            return constraints.video;\n        }\n        else if (constraints.video && constraints.resolution) {\n            return Object.assign({}, exports.VideoConstraints[constraints.resolution].resolution);\n        }\n        return constraints.video;\n    }\n    getTrack(kind) {\n        let tracks;\n        if (kind === 'video') {\n            tracks = this.getVideoTracks();\n            return tracks.length > 0 ? this.getVideoTracks()[0] : undefined;\n        }\n        tracks = this.getAudioTracks();\n        return tracks.length > 0 ? this.getAudioTracks()[0] : undefined;\n    }\n    getNewTrack(kind) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const stream = yield navigator.mediaDevices.getUserMedia({\n                [kind]: kind === 'video'\n                    ? LocalStream.computeVideoConstraints(this.constraints)\n                    : LocalStream.computeAudioConstraints(this.constraints),\n            });\n            return stream.getTracks()[0];\n        });\n    }\n    publishTrack(track) {\n        if (this.pc) {\n            if (track.kind === 'video' && this.constraints.simulcast) {\n                const idx = resolutions.indexOf(this.constraints.resolution);\n                const encodings = [\n                    {\n                        rid: 'f',\n                        maxBitrate: exports.VideoConstraints[resolutions[idx]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx]].encodings.maxFramerate,\n                    },\n                ];\n                if (idx - 1 >= 0) {\n                    encodings.push({\n                        rid: 'h',\n                        scaleResolutionDownBy: 2.0,\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxFramerate,\n                    });\n                }\n                if (idx - 2 >= 0) {\n                    encodings.push({\n                        rid: 'q',\n                        scaleResolutionDownBy: 4.0,\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxFramerate,\n                    });\n                }\n                const transceiver = this.pc.addTransceiver(track, {\n                    streams: [this],\n                    direction: 'sendonly',\n                    sendEncodings: encodings,\n                });\n                this.setPreferredCodec(transceiver, track.kind);\n            }\n            else {\n                const init = {\n                    streams: [this],\n                    direction: 'sendonly',\n                };\n                if (track.kind === 'video') {\n                    init.sendEncodings = [exports.VideoConstraints[this.constraints.resolution].encodings];\n                }\n                const transceiver = this.pc.addTransceiver(track, init);\n                this.setPreferredCodec(transceiver, track.kind);\n            }\n        }\n    }\n    setPreferredCodec(transceiver, kind) {\n        if ('setCodecPreferences' in transceiver) {\n            const cap = RTCRtpSender.getCapabilities(kind);\n            if (!cap)\n                return;\n            let selCodec;\n            if (this.constraints.preferredCodecProfile && kind === 'video') {\n                const allCodecProfiles = cap.codecs.filter((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}`);\n                if (!allCodecProfiles) {\n                    return;\n                }\n                selCodec = allCodecProfiles.find((c) => { var _a; return c.sdpFmtpLine && ((_a = c.sdpFmtpLine) === null || _a === void 0 ? void 0 : _a.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`)) >= 0; });\n                if (!selCodec) {\n                    // get first one\n                    selCodec = allCodecProfiles[0];\n                }\n            }\n            else {\n                selCodec = cap.codecs.find((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}` ||\n                    c.mimeType.toLowerCase() === `audio/opus`);\n            }\n            if (selCodec) {\n                transceiver.setCodecPreferences([selCodec]);\n            }\n        }\n    }\n    updateTrack(next, prev) {\n        this.addTrack(next);\n        // If published, replace published track with track from new device\n        if (prev) {\n            this.removeTrack(prev);\n            prev.stop();\n            if (this.pc) {\n                this.pc.getSenders().forEach((sender) => __awaiter(this, void 0, void 0, function* () {\n                    var _a, _b;\n                    if (((_a = sender === null || sender === void 0 ? void 0 : sender.track) === null || _a === void 0 ? void 0 : _a.kind) === next.kind) {\n                        (_b = sender.track) === null || _b === void 0 ? void 0 : _b.stop();\n                        sender.replaceTrack(next);\n                    }\n                }));\n            }\n        }\n        else {\n            this.addTrack(next);\n            if (this.pc) {\n                this.publishTrack(next);\n            }\n        }\n    }\n    initAudioEmptyTrack() {\n        // @ts-ignore\n        const AudioContext = window.AudioContext || window.webkitAudioContext;\n        const ctx = new AudioContext();\n        const oscillator = ctx.createOscillator();\n        oscillator.frequency.setValueAtTime(20000, ctx.currentTime);\n        const dst = oscillator.connect(ctx.createMediaStreamDestination());\n        oscillator.start();\n        return dst.stream.getAudioTracks()[0];\n    }\n    initVideoEmptyTrack(width, height) {\n        var _a;\n        const canvas = Object.assign(document.createElement('canvas'), { width, height });\n        (_a = canvas.getContext('2d')) === null || _a === void 0 ? void 0 : _a.fillRect(0, 0, width, height);\n        const stream = canvas.captureStream();\n        return stream.getVideoTracks()[0];\n    }\n    publish(pc) {\n        this.pc = pc;\n        this.getTracks().forEach(this.publishTrack.bind(this));\n    }\n    unpublish() {\n        if (this.pc) {\n            const tracks = this.getTracks();\n            this.pc.getSenders().forEach((s) => {\n                if (s.track && tracks.includes(s.track)) {\n                    this.pc.removeTrack(s);\n                }\n            });\n        }\n    }\n    switchDevice(kind, deviceId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.constraints = Object.assign(Object.assign({}, this.constraints), { [kind]: this.constraints[kind] instanceof Object\n                    ? Object.assign(Object.assign({}, this.constraints[kind]), { deviceId }) : { deviceId } });\n            const prev = this.getTrack(kind);\n            const next = yield this.getNewTrack(kind);\n            this.updateTrack(next, prev);\n        });\n    }\n    mute(kind) {\n        const track = this.getTrack(kind);\n        if (track && this.constraints.sendEmptyOnMute) {\n            const emptyTrack = kind === 'audio'\n                ? this.initAudioEmptyTrack()\n                : this.initVideoEmptyTrack((track === null || track === void 0 ? void 0 : track.getSettings().width) || 640, (track === null || track === void 0 ? void 0 : track.getSettings().height) || 360);\n            emptyTrack.enabled = false;\n            this.updateTrack(emptyTrack, track);\n            return;\n        }\n        if (track) {\n            track.stop();\n        }\n    }\n    unmute(kind) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const prev = this.getTrack(kind);\n            const track = yield this.getNewTrack(kind);\n            this.updateTrack(track, prev);\n        });\n    }\n    updateMediaEncodingParams(encodingParams) {\n        if (!this.pc)\n            return;\n        this.getTracks().forEach((track) => {\n            var _a, _b;\n            const senders = (_b = (_a = this.pc) === null || _a === void 0 ? void 0 : _a.getSenders()) === null || _b === void 0 ? void 0 : _b.filter((sender) => { var _a; return track.id === ((_a = sender.track) === null || _a === void 0 ? void 0 : _a.id); });\n            senders === null || senders === void 0 ? void 0 : senders.forEach((sender) => {\n                const params = sender.getParameters();\n                if (!params.encodings) {\n                    params.encodings = [{}];\n                }\n                params.encodings[0] = Object.assign(Object.assign({}, params.encodings[0]), encodingParams);\n                sender.setParameters(params);\n            });\n        });\n    }\n}\nexports.LocalStream = LocalStream;\nfunction makeRemote(stream, transport) {\n    const remote = stream;\n    remote.audio = true;\n    remote.video = 'none';\n    remote.framerate = 'high';\n    remote._videoPreMute = 'high';\n    const select = () => {\n        const call = {\n            streamId: remote.id,\n            video: remote.video,\n            audio: remote.audio,\n            framerate: remote.framerate,\n        };\n        if (transport.api) {\n            if (transport.api.readyState !== 'open') {\n                // queue call if we aren't open yet\n                transport.api.onopen = () => { var _a; return (_a = transport.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\n            }\n            else {\n                transport.api.send(JSON.stringify(call));\n            }\n        }\n    };\n    remote.preferLayer = (layer) => {\n        remote.video = layer;\n        select();\n    };\n    remote.preferFramerate = (layer) => {\n        remote.framerate = layer;\n        select();\n    };\n    remote.mute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = false;\n        }\n        else if (kind === 'video') {\n            remote._videoPreMute = remote.video;\n            remote.video = 'none';\n        }\n        select();\n    };\n    remote.unmute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = true;\n        }\n        else if (kind === 'video') {\n            remote.video = remote._videoPreMute;\n        }\n        select();\n    };\n    return remote;\n}\nexports.makeRemote = makeRemote;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvc3RyZWFtLnRzP2U2ZGYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYjtBQUNBLDJCQUEyQiwrREFBK0QsZ0JBQWdCLEVBQUUsRUFBRTtBQUM5RztBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixxRkFBcUY7QUFDcEg7QUFDQSxLQUFLO0FBQ0w7QUFDQSw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQyxxQkFBcUIsYUFBYTtBQUNsQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDLHFCQUFxQixhQUFhO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQyxxQkFBcUIsY0FBYztBQUNuQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDLHFCQUFxQixjQUFjO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlGQUF5RjtBQUN6Rix5RkFBeUY7QUFDekYsYUFBYTtBQUNiLHlFQUF5RTtBQUN6RSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EseUVBQXlFO0FBQ3pFLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3R0FBd0cscUNBQXFDO0FBQzdJO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxRQUFRLG1IQUFtSCx1Q0FBdUMsU0FBUyxFQUFFO0FBQ3RPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdGQUF3RixxQ0FBcUM7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsZ0JBQWdCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxzQkFBc0I7QUFDbkYsb0RBQW9ELDRCQUE0QixXQUFXLEtBQUssV0FBVyxFQUFFO0FBQzdHO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1LQUFtSyxRQUFRLHNGQUFzRixFQUFFO0FBQ25RO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBLG9FQUFvRTtBQUNwRTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsUUFBUSxnR0FBZ0c7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5tYWtlUmVtb3RlID0gZXhwb3J0cy5Mb2NhbFN0cmVhbSA9IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50cyA9IHZvaWQgMDtcbmNvbnN0IHJlc29sdXRpb25zID0gWydxdmdhJywgJ3ZnYScsICdzaGQnLCAnaGQnLCAnZmhkJywgJ3FoZCddO1xuZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzID0ge1xuICAgIHF2Z2E6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDMyMCB9LFxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAxODAgfSxcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xuICAgICAgICAgICAgICAgIGlkZWFsOiAxNSxcbiAgICAgICAgICAgICAgICBtYXg6IDMwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZW5jb2RpbmdzOiB7XG4gICAgICAgICAgICBtYXhCaXRyYXRlOiAxNTAwMDAsXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDE1LjAsXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICB2Z2E6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDY0MCB9LFxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAzNjAgfSxcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xuICAgICAgICAgICAgICAgIGlkZWFsOiAzMCxcbiAgICAgICAgICAgICAgICBtYXg6IDYwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZW5jb2RpbmdzOiB7XG4gICAgICAgICAgICBtYXhCaXRyYXRlOiA1MDAwMDAsXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBzaGQ6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDk2MCB9LFxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiA1NDAgfSxcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xuICAgICAgICAgICAgICAgIGlkZWFsOiAzMCxcbiAgICAgICAgICAgICAgICBtYXg6IDYwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZW5jb2RpbmdzOiB7XG4gICAgICAgICAgICBtYXhCaXRyYXRlOiAxMjAwMDAwLFxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxuICAgICAgICB9LFxuICAgIH0sXG4gICAgaGQ6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDEyODAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogNzIwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogMjUwMDAwMCxcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIGZoZDoge1xuICAgICAgICByZXNvbHV0aW9uOiB7XG4gICAgICAgICAgICB3aWR0aDogeyBpZGVhbDogMTkyMCB9LFxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAxMDgwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogNDAwMDAwMCxcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIHFoZDoge1xuICAgICAgICByZXNvbHV0aW9uOiB7XG4gICAgICAgICAgICB3aWR0aDogeyBpZGVhbDogMjU2MCB9LFxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAxNDQwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogODAwMDAwMCxcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcbiAgICAgICAgfSxcbiAgICB9LFxufTtcbmNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHJlc29sdXRpb246ICdoZCcsXG4gICAgY29kZWM6ICd2cDgnLFxuICAgIGF1ZGlvOiB0cnVlLFxuICAgIHZpZGVvOiB0cnVlLFxuICAgIHNpbXVsY2FzdDogZmFsc2UsXG59O1xuY2xhc3MgTG9jYWxTdHJlYW0gZXh0ZW5kcyBNZWRpYVN0cmVhbSB7XG4gICAgY29uc3RydWN0b3Ioc3RyZWFtLCBjb25zdHJhaW50cykge1xuICAgICAgICBzdXBlcihzdHJlYW0pO1xuICAgICAgICB0aGlzLmNvbnN0cmFpbnRzID0gY29uc3RyYWludHM7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRVc2VyTWVkaWEoY29uc3RyYWludHMgPSBkZWZhdWx0cykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0geWllbGQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgICAgIGF1ZGlvOiBMb2NhbFN0cmVhbS5jb21wdXRlQXVkaW9Db25zdHJhaW50cyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzKSwgY29uc3RyYWludHMpKSxcbiAgICAgICAgICAgICAgICB2aWRlbzogTG9jYWxTdHJlYW0uY29tcHV0ZVZpZGVvQ29uc3RyYWludHMoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cyksIGNvbnN0cmFpbnRzKSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTG9jYWxTdHJlYW0oc3RyZWFtLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzKSwgY29uc3RyYWludHMpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXREaXNwbGF5TWVkaWEoY29uc3RyYWludHMgPSB7XG4gICAgICAgIGNvZGVjOiAndnA4JyxcbiAgICAgICAgcmVzb2x1dGlvbjogJ2hkJyxcbiAgICAgICAgYXVkaW86IGZhbHNlLFxuICAgICAgICB2aWRlbzogdHJ1ZSxcbiAgICAgICAgc2ltdWxjYXN0OiBmYWxzZSxcbiAgICB9KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCBzdHJlYW0gPSB5aWVsZCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYShjb25zdHJhaW50cyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExvY2FsU3RyZWFtKHN0cmVhbSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cyksIGNvbnN0cmFpbnRzKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZUF1ZGlvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcbiAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnRzLmF1ZGlvO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZVZpZGVvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzLnZpZGVvIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc3RyYWludHMudmlkZW87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uc3RyYWludHMudmlkZW8gJiYgY29uc3RyYWludHMucmVzb2x1dGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tjb25zdHJhaW50cy5yZXNvbHV0aW9uXS5yZXNvbHV0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uc3RyYWludHMudmlkZW87XG4gICAgfVxuICAgIGdldFRyYWNrKGtpbmQpIHtcbiAgICAgICAgbGV0IHRyYWNrcztcbiAgICAgICAgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgIHRyYWNrcyA9IHRoaXMuZ2V0VmlkZW9UcmFja3MoKTtcbiAgICAgICAgICAgIHJldHVybiB0cmFja3MubGVuZ3RoID4gMCA/IHRoaXMuZ2V0VmlkZW9UcmFja3MoKVswXSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB0cmFja3MgPSB0aGlzLmdldEF1ZGlvVHJhY2tzKCk7XG4gICAgICAgIHJldHVybiB0cmFja3MubGVuZ3RoID4gMCA/IHRoaXMuZ2V0QXVkaW9UcmFja3MoKVswXSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZ2V0TmV3VHJhY2soa2luZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0geWllbGQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgICAgIFtraW5kXToga2luZCA9PT0gJ3ZpZGVvJ1xuICAgICAgICAgICAgICAgICAgICA/IExvY2FsU3RyZWFtLmNvbXB1dGVWaWRlb0NvbnN0cmFpbnRzKHRoaXMuY29uc3RyYWludHMpXG4gICAgICAgICAgICAgICAgICAgIDogTG9jYWxTdHJlYW0uY29tcHV0ZUF1ZGlvQ29uc3RyYWludHModGhpcy5jb25zdHJhaW50cyksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZ2V0VHJhY2tzKClbMF07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaXNoVHJhY2sodHJhY2spIHtcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSAndmlkZW8nICYmIHRoaXMuY29uc3RyYWludHMuc2ltdWxjYXN0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gcmVzb2x1dGlvbnMuaW5kZXhPZih0aGlzLmNvbnN0cmFpbnRzLnJlc29sdXRpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVuY29kaW5ncyA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmlkOiAnZicsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhCaXRyYXRlOiBleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbcmVzb2x1dGlvbnNbaWR4XV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHhdXS5lbmNvZGluZ3MubWF4RnJhbWVyYXRlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgaWYgKGlkeCAtIDEgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBlbmNvZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICByaWQ6ICdoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogMi4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4Qml0cmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDFdXS5lbmNvZGluZ3MubWF4Qml0cmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDFdXS5lbmNvZGluZ3MubWF4RnJhbWVyYXRlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlkeCAtIDIgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBlbmNvZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICByaWQ6ICdxJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogNC4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4Qml0cmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDJdXS5lbmNvZGluZ3MubWF4Qml0cmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDJdXS5lbmNvZGluZ3MubWF4RnJhbWVyYXRlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhbnNjZWl2ZXIgPSB0aGlzLnBjLmFkZFRyYW5zY2VpdmVyKHRyYWNrLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbXM6IFt0aGlzXSxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnc2VuZG9ubHknLFxuICAgICAgICAgICAgICAgICAgICBzZW5kRW5jb2RpbmdzOiBlbmNvZGluZ3MsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQcmVmZXJyZWRDb2RlYyh0cmFuc2NlaXZlciwgdHJhY2sua2luZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbml0ID0ge1xuICAgICAgICAgICAgICAgICAgICBzdHJlYW1zOiBbdGhpc10sXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ3NlbmRvbmx5JyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IFtleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbdGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uXS5lbmNvZGluZ3NdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2NlaXZlciA9IHRoaXMucGMuYWRkVHJhbnNjZWl2ZXIodHJhY2ssIGluaXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UHJlZmVycmVkQ29kZWModHJhbnNjZWl2ZXIsIHRyYWNrLmtpbmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHNldFByZWZlcnJlZENvZGVjKHRyYW5zY2VpdmVyLCBraW5kKSB7XG4gICAgICAgIGlmICgnc2V0Q29kZWNQcmVmZXJlbmNlcycgaW4gdHJhbnNjZWl2ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhcCA9IFJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMoa2luZCk7XG4gICAgICAgICAgICBpZiAoIWNhcClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBsZXQgc2VsQ29kZWM7XG4gICAgICAgICAgICBpZiAodGhpcy5jb25zdHJhaW50cy5wcmVmZXJyZWRDb2RlY1Byb2ZpbGUgJiYga2luZCA9PT0gJ3ZpZGVvJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFsbENvZGVjUHJvZmlsZXMgPSBjYXAuY29kZWNzLmZpbHRlcigoYykgPT4gYy5taW1lVHlwZS50b0xvd2VyQ2FzZSgpID09PSBgdmlkZW8vJHt0aGlzLmNvbnN0cmFpbnRzLmNvZGVjLnRvTG93ZXJDYXNlKCl9YCk7XG4gICAgICAgICAgICAgICAgaWYgKCFhbGxDb2RlY1Byb2ZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsQ29kZWMgPSBhbGxDb2RlY1Byb2ZpbGVzLmZpbmQoKGMpID0+IHsgdmFyIF9hOyByZXR1cm4gYy5zZHBGbXRwTGluZSAmJiAoKF9hID0gYy5zZHBGbXRwTGluZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluZGV4T2YoYHByb2ZpbGUtbGV2ZWwtaWQ9JHt0aGlzLmNvbnN0cmFpbnRzLnByZWZlcnJlZENvZGVjUHJvZmlsZX1gKSkgPj0gMDsgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFzZWxDb2RlYykge1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZmlyc3Qgb25lXG4gICAgICAgICAgICAgICAgICAgIHNlbENvZGVjID0gYWxsQ29kZWNQcm9maWxlc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxDb2RlYyA9IGNhcC5jb2RlY3MuZmluZCgoYykgPT4gYy5taW1lVHlwZS50b0xvd2VyQ2FzZSgpID09PSBgdmlkZW8vJHt0aGlzLmNvbnN0cmFpbnRzLmNvZGVjLnRvTG93ZXJDYXNlKCl9YCB8fFxuICAgICAgICAgICAgICAgICAgICBjLm1pbWVUeXBlLnRvTG93ZXJDYXNlKCkgPT09IGBhdWRpby9vcHVzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VsQ29kZWMpIHtcbiAgICAgICAgICAgICAgICB0cmFuc2NlaXZlci5zZXRDb2RlY1ByZWZlcmVuY2VzKFtzZWxDb2RlY10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZVRyYWNrKG5leHQsIHByZXYpIHtcbiAgICAgICAgdGhpcy5hZGRUcmFjayhuZXh0KTtcbiAgICAgICAgLy8gSWYgcHVibGlzaGVkLCByZXBsYWNlIHB1Ymxpc2hlZCB0cmFjayB3aXRoIHRyYWNrIGZyb20gbmV3IGRldmljZVxuICAgICAgICBpZiAocHJldikge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVUcmFjayhwcmV2KTtcbiAgICAgICAgICAgIHByZXYuc3RvcCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKChzZW5kZXIpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCgoX2EgPSBzZW5kZXIgPT09IG51bGwgfHwgc2VuZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZW5kZXIudHJhY2spID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5raW5kKSA9PT0gbmV4dC5raW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2IgPSBzZW5kZXIudHJhY2spID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXIucmVwbGFjZVRyYWNrKG5leHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hZGRUcmFjayhuZXh0KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnBjKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wdWJsaXNoVHJhY2sobmV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaW5pdEF1ZGlvRW1wdHlUcmFjaygpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBBdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7XG4gICAgICAgIGNvbnN0IGN0eCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICAgICAgY29uc3Qgb3NjaWxsYXRvciA9IGN0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgICAgIG9zY2lsbGF0b3IuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKDIwMDAwLCBjdHguY3VycmVudFRpbWUpO1xuICAgICAgICBjb25zdCBkc3QgPSBvc2NpbGxhdG9yLmNvbm5lY3QoY3R4LmNyZWF0ZU1lZGlhU3RyZWFtRGVzdGluYXRpb24oKSk7XG4gICAgICAgIG9zY2lsbGF0b3Iuc3RhcnQoKTtcbiAgICAgICAgcmV0dXJuIGRzdC5zdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXTtcbiAgICB9XG4gICAgaW5pdFZpZGVvRW1wdHlUcmFjayh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgY2FudmFzID0gT2JqZWN0LmFzc2lnbihkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSwgeyB3aWR0aCwgaGVpZ2h0IH0pO1xuICAgICAgICAoX2EgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBjb25zdCBzdHJlYW0gPSBjYW52YXMuY2FwdHVyZVN0cmVhbSgpO1xuICAgICAgICByZXR1cm4gc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF07XG4gICAgfVxuICAgIHB1Ymxpc2gocGMpIHtcbiAgICAgICAgdGhpcy5wYyA9IHBjO1xuICAgICAgICB0aGlzLmdldFRyYWNrcygpLmZvckVhY2godGhpcy5wdWJsaXNoVHJhY2suYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIHVucHVibGlzaCgpIHtcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMuZ2V0VHJhY2tzKCk7XG4gICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKChzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHMudHJhY2sgJiYgdHJhY2tzLmluY2x1ZGVzKHMudHJhY2spKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGMucmVtb3ZlVHJhY2socyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3dpdGNoRGV2aWNlKGtpbmQsIGRldmljZUlkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnN0cmFpbnRzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbnN0cmFpbnRzKSwgeyBba2luZF06IHRoaXMuY29uc3RyYWludHNba2luZF0gaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgICAgICAgICAgICAgICAgPyBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29uc3RyYWludHNba2luZF0pLCB7IGRldmljZUlkIH0pIDogeyBkZXZpY2VJZCB9IH0pO1xuICAgICAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XG4gICAgICAgICAgICBjb25zdCBuZXh0ID0geWllbGQgdGhpcy5nZXROZXdUcmFjayhraW5kKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVHJhY2sobmV4dCwgcHJldik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtdXRlKGtpbmQpIHtcbiAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLmdldFRyYWNrKGtpbmQpO1xuICAgICAgICBpZiAodHJhY2sgJiYgdGhpcy5jb25zdHJhaW50cy5zZW5kRW1wdHlPbk11dGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGVtcHR5VHJhY2sgPSBraW5kID09PSAnYXVkaW8nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmluaXRBdWRpb0VtcHR5VHJhY2soKVxuICAgICAgICAgICAgICAgIDogdGhpcy5pbml0VmlkZW9FbXB0eVRyYWNrKCh0cmFjayA9PT0gbnVsbCB8fCB0cmFjayA9PT0gdm9pZCAwID8gdm9pZCAwIDogdHJhY2suZ2V0U2V0dGluZ3MoKS53aWR0aCkgfHwgNjQwLCAodHJhY2sgPT09IG51bGwgfHwgdHJhY2sgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRyYWNrLmdldFNldHRpbmdzKCkuaGVpZ2h0KSB8fCAzNjApO1xuICAgICAgICAgICAgZW1wdHlUcmFjay5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRyYWNrKGVtcHR5VHJhY2ssIHRyYWNrKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHJhY2spIHtcbiAgICAgICAgICAgIHRyYWNrLnN0b3AoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1bm11dGUoa2luZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XG4gICAgICAgICAgICBjb25zdCB0cmFjayA9IHlpZWxkIHRoaXMuZ2V0TmV3VHJhY2soa2luZCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRyYWNrKHRyYWNrLCBwcmV2KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZU1lZGlhRW5jb2RpbmdQYXJhbXMoZW5jb2RpbmdQYXJhbXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBjKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmdldFRyYWNrcygpLmZvckVhY2goKHRyYWNrKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgY29uc3Qgc2VuZGVycyA9IChfYiA9IChfYSA9IHRoaXMucGMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRTZW5kZXJzKCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5maWx0ZXIoKHNlbmRlcikgPT4geyB2YXIgX2E7IHJldHVybiB0cmFjay5pZCA9PT0gKChfYSA9IHNlbmRlci50cmFjaykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkKTsgfSk7XG4gICAgICAgICAgICBzZW5kZXJzID09PSBudWxsIHx8IHNlbmRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbmRlcnMuZm9yRWFjaCgoc2VuZGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gc2VuZGVyLmdldFBhcmFtZXRlcnMoKTtcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmFtcy5lbmNvZGluZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmVuY29kaW5ncyA9IFt7fV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhcmFtcy5lbmNvZGluZ3NbMF0gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcy5lbmNvZGluZ3NbMF0pLCBlbmNvZGluZ1BhcmFtcyk7XG4gICAgICAgICAgICAgICAgc2VuZGVyLnNldFBhcmFtZXRlcnMocGFyYW1zKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkxvY2FsU3RyZWFtID0gTG9jYWxTdHJlYW07XG5mdW5jdGlvbiBtYWtlUmVtb3RlKHN0cmVhbSwgdHJhbnNwb3J0KSB7XG4gICAgY29uc3QgcmVtb3RlID0gc3RyZWFtO1xuICAgIHJlbW90ZS5hdWRpbyA9IHRydWU7XG4gICAgcmVtb3RlLnZpZGVvID0gJ25vbmUnO1xuICAgIHJlbW90ZS5mcmFtZXJhdGUgPSAnaGlnaCc7XG4gICAgcmVtb3RlLl92aWRlb1ByZU11dGUgPSAnaGlnaCc7XG4gICAgY29uc3Qgc2VsZWN0ID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBjYWxsID0ge1xuICAgICAgICAgICAgc3RyZWFtSWQ6IHJlbW90ZS5pZCxcbiAgICAgICAgICAgIHZpZGVvOiByZW1vdGUudmlkZW8sXG4gICAgICAgICAgICBhdWRpbzogcmVtb3RlLmF1ZGlvLFxuICAgICAgICAgICAgZnJhbWVyYXRlOiByZW1vdGUuZnJhbWVyYXRlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodHJhbnNwb3J0LmFwaSkge1xuICAgICAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkucmVhZHlTdGF0ZSAhPT0gJ29wZW4nKSB7XG4gICAgICAgICAgICAgICAgLy8gcXVldWUgY2FsbCBpZiB3ZSBhcmVuJ3Qgb3BlbiB5ZXRcbiAgICAgICAgICAgICAgICB0cmFuc3BvcnQuYXBpLm9ub3BlbiA9ICgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdHJhbnNwb3J0LmFwaSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlbmQoSlNPTi5zdHJpbmdpZnkoY2FsbCkpOyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdHJhbnNwb3J0LmFwaS5zZW5kKEpTT04uc3RyaW5naWZ5KGNhbGwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVtb3RlLnByZWZlckxheWVyID0gKGxheWVyKSA9PiB7XG4gICAgICAgIHJlbW90ZS52aWRlbyA9IGxheWVyO1xuICAgICAgICBzZWxlY3QoKTtcbiAgICB9O1xuICAgIHJlbW90ZS5wcmVmZXJGcmFtZXJhdGUgPSAobGF5ZXIpID0+IHtcbiAgICAgICAgcmVtb3RlLmZyYW1lcmF0ZSA9IGxheWVyO1xuICAgICAgICBzZWxlY3QoKTtcbiAgICB9O1xuICAgIHJlbW90ZS5tdXRlID0gKGtpbmQpID0+IHtcbiAgICAgICAgaWYgKGtpbmQgPT09ICdhdWRpbycpIHtcbiAgICAgICAgICAgIHJlbW90ZS5hdWRpbyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgIHJlbW90ZS5fdmlkZW9QcmVNdXRlID0gcmVtb3RlLnZpZGVvO1xuICAgICAgICAgICAgcmVtb3RlLnZpZGVvID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICAgIHNlbGVjdCgpO1xuICAgIH07XG4gICAgcmVtb3RlLnVubXV0ZSA9IChraW5kKSA9PiB7XG4gICAgICAgIGlmIChraW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICByZW1vdGUuYXVkaW8gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgIHJlbW90ZS52aWRlbyA9IHJlbW90ZS5fdmlkZW9QcmVNdXRlO1xuICAgICAgICB9XG4gICAgICAgIHNlbGVjdCgpO1xuICAgIH07XG4gICAgcmV0dXJuIHJlbW90ZTtcbn1cbmV4cG9ydHMubWFrZVJlbW90ZSA9IG1ha2VSZW1vdGU7XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,exports,__webpack_require__){"use strict";eval('\nObject.defineProperty(exports, "__esModule", { value: true });\nexports.LocalStream = exports.Client = void 0;\nconst client_1 = __webpack_require__(2);\nexports.Client = client_1.default;\nconst stream_1 = __webpack_require__(0);\nObject.defineProperty(exports, "LocalStream", { enumerable: true, get: function () { return stream_1.LocalStream; } });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvaW5kZXgudHM/NzFiZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0EsaUJBQWlCLG1CQUFPLENBQUMsQ0FBVTtBQUNuQztBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkMsK0NBQStDLHFDQUFxQyw2QkFBNkIsRUFBRSxFQUFFIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTG9jYWxTdHJlYW0gPSBleHBvcnRzLkNsaWVudCA9IHZvaWQgMDtcbmNvbnN0IGNsaWVudF8xID0gcmVxdWlyZShcIi4vY2xpZW50XCIpO1xuZXhwb3J0cy5DbGllbnQgPSBjbGllbnRfMS5kZWZhdWx0O1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwiLi9zdHJlYW1cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJMb2NhbFN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RyZWFtXzEuTG9jYWxTdHJlYW07IH0gfSk7XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n')},function(module,exports,__webpack_require__){"use strict";eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transport = void 0;\nconst stream_1 = __webpack_require__(0);\nconst API_CHANNEL = 'ion-sfu';\nconst ERR_NO_SESSION = 'no active session, join first';\nvar Role;\n(function (Role) {\n    Role[Role[\"pub\"] = 0] = \"pub\";\n    Role[Role[\"sub\"] = 1] = \"sub\";\n})(Role || (Role = {}));\nclass Transport {\n    constructor(role, signal, config) {\n        this.signal = signal;\n        this.pc = new RTCPeerConnection(config);\n        this.candidates = [];\n        if (role === Role.pub) {\n            this.pc.createDataChannel(API_CHANNEL);\n        }\n        this.pc.onicecandidate = ({ candidate }) => {\n            if (candidate) {\n                this.signal.trickle({ target: role, candidate });\n            }\n        };\n        this.pc.oniceconnectionstatechange = (e) => __awaiter(this, void 0, void 0, function* () {\n            if (this.pc.iceConnectionState === 'disconnected') {\n                if (this.pc.restartIce) {\n                    // this will trigger onNegotiationNeeded\n                    this.pc.restartIce();\n                }\n            }\n        });\n    }\n}\nexports.Transport = Transport;\nclass Client {\n    constructor(signal, config = {\n        codec: 'vp8',\n        iceServers: [\n            {\n                urls: ['stun:stun.l.google.com:19302', 'stun:stun1.l.google.com:19302'],\n            },\n        ],\n    }) {\n        this.signal = signal;\n        this.config = config;\n        signal.onnegotiate = this.negotiate.bind(this);\n        signal.ontrickle = this.trickle.bind(this);\n    }\n    join(sid, uid) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.transports = {\n                [Role.pub]: new Transport(Role.pub, this.signal, this.config),\n                [Role.sub]: new Transport(Role.sub, this.signal, this.config),\n            };\n            this.transports[Role.sub].pc.ontrack = (ev) => {\n                const stream = ev.streams[0];\n                const remote = stream_1.makeRemote(stream, this.transports[Role.sub]);\n                if (this.ontrack) {\n                    this.ontrack(ev.track, remote);\n                }\n            };\n            const apiReady = new Promise((resolve) => {\n                this.transports[Role.sub].pc.ondatachannel = (ev) => {\n                    if (ev.channel.label === API_CHANNEL) {\n                        this.transports[Role.sub].api = ev.channel;\n                        ev.channel.onmessage = (e) => {\n                            if (this.onspeaker) {\n                                this.onspeaker(JSON.parse(e.data));\n                            }\n                        };\n                        resolve();\n                        return;\n                    }\n                    if (this.ondatachannel) {\n                        this.ondatachannel(ev);\n                    }\n                };\n            });\n            const offer = yield this.transports[Role.pub].pc.createOffer();\n            yield this.transports[Role.pub].pc.setLocalDescription(offer);\n            const answer = yield this.signal.join(sid, uid, offer);\n            yield this.transports[Role.pub].pc.setRemoteDescription(answer);\n            this.transports[Role.pub].candidates.forEach((c) => this.transports[Role.pub].pc.addIceCandidate(c));\n            this.transports[Role.pub].pc.onnegotiationneeded = this.onNegotiationNeeded.bind(this);\n            return apiReady;\n        });\n    }\n    leave() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n            delete this.transports;\n        }\n    }\n    getPubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.getStats(selector);\n    }\n    getSubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.sub].pc.getStats(selector);\n    }\n    publish(stream) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        stream.publish(this.transports[Role.pub].pc);\n    }\n    createDataChannel(label) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.createDataChannel(label);\n    }\n    close() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n        }\n        this.signal.close();\n    }\n    trickle({ candidate, target }) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        if (this.transports[target].pc.remoteDescription) {\n            this.transports[target].pc.addIceCandidate(candidate);\n        }\n        else {\n            this.transports[target].candidates.push(candidate);\n        }\n    }\n    negotiate(description) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.transports) {\n                throw Error(ERR_NO_SESSION);\n            }\n            let answer;\n            try {\n                yield this.transports[Role.sub].pc.setRemoteDescription(description);\n                this.transports[Role.sub].candidates.forEach((c) => this.transports[Role.sub].pc.addIceCandidate(c));\n                this.transports[Role.sub].candidates = [];\n                answer = yield this.transports[Role.sub].pc.createAnswer();\n                yield this.transports[Role.sub].pc.setLocalDescription(answer);\n                this.signal.answer(answer);\n            }\n            catch (err) {\n                /* tslint:disable-next-line:no-console */\n                console.error(err);\n                if (this.onerrnegotiate)\n                    this.onerrnegotiate(Role.sub, err, description, answer);\n            }\n        });\n    }\n    onNegotiationNeeded() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.transports) {\n                throw Error(ERR_NO_SESSION);\n            }\n            let offer;\n            let answer;\n            try {\n                offer = yield this.transports[Role.pub].pc.createOffer();\n                yield this.transports[Role.pub].pc.setLocalDescription(offer);\n                answer = yield this.signal.offer(offer);\n                yield this.transports[Role.pub].pc.setRemoteDescription(answer);\n            }\n            catch (err) {\n                /* tslint:disable-next-line:no-console */\n                console.error(err);\n                if (this.onerrnegotiate)\n                    this.onerrnegotiate(Role.pub, err, offer, answer);\n            }\n        });\n    }\n}\nexports.default = Client;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvY2xpZW50LnRzP2U3MWIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYjtBQUNBLDJCQUEyQiwrREFBK0QsZ0JBQWdCLEVBQUUsRUFBRTtBQUM5RztBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixxRkFBcUY7QUFDcEg7QUFDQSxLQUFLO0FBQ0w7QUFDQSw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvQkFBb0I7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxZQUFZO0FBQy9DO0FBQ0EscUNBQXFDLDBCQUEwQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxvQkFBb0I7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBIiwiZmlsZSI6IjIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UcmFuc3BvcnQgPSB2b2lkIDA7XG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCIuL3N0cmVhbVwiKTtcbmNvbnN0IEFQSV9DSEFOTkVMID0gJ2lvbi1zZnUnO1xuY29uc3QgRVJSX05PX1NFU1NJT04gPSAnbm8gYWN0aXZlIHNlc3Npb24sIGpvaW4gZmlyc3QnO1xudmFyIFJvbGU7XG4oZnVuY3Rpb24gKFJvbGUpIHtcbiAgICBSb2xlW1JvbGVbXCJwdWJcIl0gPSAwXSA9IFwicHViXCI7XG4gICAgUm9sZVtSb2xlW1wic3ViXCJdID0gMV0gPSBcInN1YlwiO1xufSkoUm9sZSB8fCAoUm9sZSA9IHt9KSk7XG5jbGFzcyBUcmFuc3BvcnQge1xuICAgIGNvbnN0cnVjdG9yKHJvbGUsIHNpZ25hbCwgY29uZmlnKSB7XG4gICAgICAgIHRoaXMuc2lnbmFsID0gc2lnbmFsO1xuICAgICAgICB0aGlzLnBjID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGNvbmZpZyk7XG4gICAgICAgIHRoaXMuY2FuZGlkYXRlcyA9IFtdO1xuICAgICAgICBpZiAocm9sZSA9PT0gUm9sZS5wdWIpIHtcbiAgICAgICAgICAgIHRoaXMucGMuY3JlYXRlRGF0YUNoYW5uZWwoQVBJX0NIQU5ORUwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGMub25pY2VjYW5kaWRhdGUgPSAoeyBjYW5kaWRhdGUgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmFsLnRyaWNrbGUoeyB0YXJnZXQ6IHJvbGUsIGNhbmRpZGF0ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wYy5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IChlKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYy5pY2VDb25uZWN0aW9uU3RhdGUgPT09ICdkaXNjb25uZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGMucmVzdGFydEljZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgdHJpZ2dlciBvbk5lZ290aWF0aW9uTmVlZGVkXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGMucmVzdGFydEljZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5UcmFuc3BvcnQgPSBUcmFuc3BvcnQ7XG5jbGFzcyBDbGllbnQge1xuICAgIGNvbnN0cnVjdG9yKHNpZ25hbCwgY29uZmlnID0ge1xuICAgICAgICBjb2RlYzogJ3ZwOCcsXG4gICAgICAgIGljZVNlcnZlcnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB1cmxzOiBbJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInLCAnc3R1bjpzdHVuMS5sLmdvb2dsZS5jb206MTkzMDInXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSkge1xuICAgICAgICB0aGlzLnNpZ25hbCA9IHNpZ25hbDtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgICAgIHNpZ25hbC5vbm5lZ290aWF0ZSA9IHRoaXMubmVnb3RpYXRlLmJpbmQodGhpcyk7XG4gICAgICAgIHNpZ25hbC5vbnRyaWNrbGUgPSB0aGlzLnRyaWNrbGUuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgam9pbihzaWQsIHVpZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzID0ge1xuICAgICAgICAgICAgICAgIFtSb2xlLnB1Yl06IG5ldyBUcmFuc3BvcnQoUm9sZS5wdWIsIHRoaXMuc2lnbmFsLCB0aGlzLmNvbmZpZyksXG4gICAgICAgICAgICAgICAgW1JvbGUuc3ViXTogbmV3IFRyYW5zcG9ydChSb2xlLnN1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLm9udHJhY2sgPSAoZXYpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBldi5zdHJlYW1zWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbW90ZSA9IHN0cmVhbV8xLm1ha2VSZW1vdGUoc3RyZWFtLCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vbnRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub250cmFjayhldi50cmFjaywgcmVtb3RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgYXBpUmVhZHkgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMub25kYXRhY2hhbm5lbCA9IChldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXYuY2hhbm5lbC5sYWJlbCA9PT0gQVBJX0NIQU5ORUwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0uYXBpID0gZXYuY2hhbm5lbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2LmNoYW5uZWwub25tZXNzYWdlID0gKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbnNwZWFrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbnNwZWFrZXIoSlNPTi5wYXJzZShlLmRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uZGF0YWNoYW5uZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25kYXRhY2hhbm5lbChldik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBvZmZlciA9IHlpZWxkIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuY3JlYXRlT2ZmZXIoKTtcbiAgICAgICAgICAgIHlpZWxkIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XG4gICAgICAgICAgICBjb25zdCBhbnN3ZXIgPSB5aWVsZCB0aGlzLnNpZ25hbC5qb2luKHNpZCwgdWlkLCBvZmZlcik7XG4gICAgICAgICAgICB5aWVsZCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKGFuc3dlcik7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLmNhbmRpZGF0ZXMuZm9yRWFjaCgoYykgPT4gdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5hZGRJY2VDYW5kaWRhdGUoYykpO1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5vbm5lZ290aWF0aW9ubmVlZGVkID0gdGhpcy5vbk5lZ290aWF0aW9uTmVlZGVkLmJpbmQodGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gYXBpUmVhZHk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsZWF2ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnRyYW5zcG9ydHMpLmZvckVhY2goKHQpID0+IHQucGMuY2xvc2UoKSk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy50cmFuc3BvcnRzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFB1YlN0YXRzKHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuZ2V0U3RhdHMoc2VsZWN0b3IpO1xuICAgIH1cbiAgICBnZXRTdWJTdGF0cyhzZWxlY3Rvcikge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLmdldFN0YXRzKHNlbGVjdG9yKTtcbiAgICB9XG4gICAgcHVibGlzaChzdHJlYW0pIHtcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0ucHVibGlzaCh0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjKTtcbiAgICB9XG4gICAgY3JlYXRlRGF0YUNoYW5uZWwobGFiZWwpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5jcmVhdGVEYXRhQ2hhbm5lbChsYWJlbCk7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMudHJhbnNwb3J0cykuZm9yRWFjaCgodCkgPT4gdC5wYy5jbG9zZSgpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNpZ25hbC5jbG9zZSgpO1xuICAgIH1cbiAgICB0cmlja2xlKHsgY2FuZGlkYXRlLCB0YXJnZXQgfSkge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHNbdGFyZ2V0XS5wYy5yZW1vdGVEZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW3RhcmdldF0ucGMuYWRkSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbdGFyZ2V0XS5jYW5kaWRhdGVzLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZWdvdGlhdGUoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGFuc3dlcjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihkZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5jYW5kaWRhdGVzLmZvckVhY2goKGMpID0+IHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMuYWRkSWNlQ2FuZGlkYXRlKGMpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBhbnN3ZXIgPSB5aWVsZCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLmNyZWF0ZUFuc3dlcigpO1xuICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihhbnN3ZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmFsLmFuc3dlcihhbnN3ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uZXJybmVnb3RpYXRlKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uZXJybmVnb3RpYXRlKFJvbGUuc3ViLCBlcnIsIGRlc2NyaXB0aW9uLCBhbnN3ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgb25OZWdvdGlhdGlvbk5lZWRlZCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG9mZmVyO1xuICAgICAgICAgICAgbGV0IGFuc3dlcjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgb2ZmZXIgPSB5aWVsZCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZU9mZmVyKCk7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRMb2NhbERlc2NyaXB0aW9uKG9mZmVyKTtcbiAgICAgICAgICAgICAgICBhbnN3ZXIgPSB5aWVsZCB0aGlzLnNpZ25hbC5vZmZlcihvZmZlcik7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihhbnN3ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uZXJybmVnb3RpYXRlKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uZXJybmVnb3RpYXRlKFJvbGUucHViLCBlcnIsIG9mZmVyLCBhbnN3ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBDbGllbnQ7XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2\n")}]);